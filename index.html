<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Elf Post - Create Your Santa Voicemail</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Domine:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Domine', serif;
            background: linear-gradient(135deg, #2e8045 0%, #245a33 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 650px;
            margin: 0 auto;
            background: #2e8045;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .logo-container { text-align: center; margin-bottom: 30px; }
        .logo { max-width: 300px; height: auto; }
        h1 {
            color: #ffffff; text-align: center; font-size: 32px; font-weight: 700;
            margin-bottom: 10px; letter-spacing: -0.5px;
        }
        .subtitle {
            text-align: center; color: #ffffff; margin-bottom: 40px;
            font-size: 16px; line-height: 1.5; font-weight: 500;
        }
        .loading { text-align: center; padding: 60px 20px; color: #ffffff; }
        .loading-spinner { font-size: 48px; margin-bottom: 20px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-message { display: none; text-align: center; padding: 40px 20px; }
        .error-message.show { display: block; }
        .error-icon { font-size: 80px; margin-bottom: 24px; }
        .error-message h2 { color: #ffffff; font-size: 28px; margin-bottom: 16px; }
        .error-message p { color: rgba(255,255,255,0.9); font-size: 16px; line-height: 1.6; margin-bottom: 12px; }
        .contact-link { color: #ffd700; text-decoration: underline; font-weight: 600; }
        .form-group { margin-bottom: 24px; }
        label { display: block; color: #ffffff; font-weight: 700; margin-bottom: 8px; font-size: 15px; }
        label .required { color: #d11414; }
        input[type="text"], input[type="email"], input[type="number"], textarea, select {
            width: 100%; padding: 14px 16px; border: 3px solid #2e8045; border-radius: 12px;
            font-size: 16px; font-family: 'Domine', serif; transition: all 0.3s; background: #ffffff;
        }
        input:focus, textarea:focus, select:focus {
            outline: none; border-color: #d11414; box-shadow: 0 0 0 3px rgba(209, 20, 20, 0.1);
        }
        textarea { resize: vertical; min-height: 100px; }
        .helper-text { font-size: 13px; color: rgba(255,255,255,0.8); margin-top: 6px; }
        .radio-group { display: flex; gap: 24px; margin-top: 10px; }
        .radio-option { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .radio-option input[type="radio"] { width: 22px; height: 22px; accent-color: #d11414; cursor: pointer; }
        .radio-option label { margin: 0; cursor: pointer; font-weight: 600; }
        .conditional-field { display: none; margin-top: 15px; }
        .conditional-field.show { display: block; }
        .submit-btn {
            width: 100%; padding: 18px; background: linear-gradient(135deg, #d11414 0%, #a01010 100%);
            color: #ffffff; border: 3px solid #8b0000; border-radius: 12px; font-size: 20px; font-weight: 700;
            font-family: 'Domine', serif; cursor: pointer; transition: all 0.3s; margin-top: 30px;
            text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 6px 20px rgba(209, 20, 20, 0.3);
        }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(209, 20, 20, 0.4); }
        .submit-btn:active { transform: translateY(-1px); }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .success-message { display: none; text-align: center; padding: 40px 20px; }
        .success-message.show { display: block; }
        .success-icon { font-size: 80px; margin-bottom: 24px; }
        .success-message h2 { color: #ffffff; font-size: 28px; margin-bottom: 16px; }
        .success-message p { color: rgba(255,255,255,0.9); font-size: 16px; line-height: 1.6; margin-bottom: 12px; }
        .success-highlight { background: rgba(255,255,255,0.15); padding: 16px; border-radius: 12px; font-weight: 600; font-size: 18px; margin: 20px 0; }
        #formSection { display: none; }
        #formSection.show { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <!-- <img src="your-logo.png" alt="The Elf Post" class="logo"> -->
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="loading-spinner">ðŸŽ…</div>
            <h2>Validating your access...</h2>
            <p>Please wait while Santa checks your invitation!</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error-message">
            <div class="error-icon">ðŸŽ„</div>
            <h2>Oops! Something Went Wrong...</h2>
            <p id="errorText"></p>
            <p style="margin-top: 20px;">Don't worry! Santa's elves are here to help. Please contact us at <a href="mailto:santa@theelfpost.com" class="contact-link">santa@theelfpost.com</a> and we'll get this sorted out! ðŸŽ…</p>
        </div>

        <!-- Form Section -->
        <div id="formSection">
            <h1>ðŸŽ… Create Your Santa Voicemail ðŸŽ„</h1>
            <p class="subtitle">âœ¨ Fill in the magical details below and Santa will create a personalized voicemail for your child! âœ¨</p>

            <form id="santaForm">
                <input type="hidden" id="accessToken" name="accessToken">

                <div class="form-group">
                    <label for="childName">Child's Name <span class="required">*</span></label>
                    <input type="text" id="childName" name="childName" required placeholder="e.g., Oliver">
                </div>

                <div class="form-group">
                    <label for="age">Age <span class="required">*</span></label>
                    <input type="number" id="age" name="age" min="1" max="12" required placeholder="e.g., 7">
                </div>

                <div class="form-group">
                    <label for="familyMembers">Family Members <span class="required">*</span></label>
                    <input type="text" id="familyMembers" name="familyMembers" required placeholder="e.g., Mummy Sarah and Daddy James, or Mummy and Mum, or just Mummy">
                    <div class="helper-text">Tell us parent/guardian names so Santa mentions your family correctly</div>
                </div>

                <div class="form-group">
                    <label>Does your child have any siblings?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="siblingsYes" name="hasSiblings" value="yes">
                            <label for="siblingsYes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="siblingsNo" name="hasSiblings" value="no" checked>
                            <label for="siblingsNo">No</label>
                        </div>
                    </div>
                    <div id="siblingsField" class="conditional-field">
                        <label for="siblings">Sibling Names & Ages</label>
                        <input type="text" id="siblings" name="siblings" placeholder="e.g., little sister Etta (age 4)">
                        <div class="helper-text">Include names and ages to make it extra special</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Does your child have any pets?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="petsYes" name="hasPets" value="yes">
                            <label for="petsYes">Yes</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="petsNo" name="hasPets" value="no" checked>
                            <label for="petsNo">No</label>
                        </div>
                    </div>
                    <div id="petNamesField" class="conditional-field">
                        <label for="petNames">Pet Names & Types</label>
                        <input type="text" id="petNames" name="petNames" placeholder="e.g., Biscuit (golden retriever), Whiskers (cat)">
                    </div>
                </div>

                <div class="form-group">
                    <label for="niceThings">Nice Things They've Done <span class="required">*</span></label>
                    <textarea id="niceThings" name="niceThings" required placeholder="e.g., Helped little sister learn to ride her bike, always tidies room, raised money for charity"></textarea>
                    <div class="helper-text">Santa loves to celebrate good deeds!</div>
                </div>

                <div class="form-group">
                    <label for="wishes">Christmas Wishes <span class="required">*</span></label>
                    <textarea id="wishes" name="wishes" required placeholder="e.g., LEGO set, new bike, art supplies"></textarea>
                </div>

                <div class="form-group">
                    <label for="recentTrips">Recent Trips or Special Events</label>
                    <input type="text" id="recentTrips" name="recentTrips" placeholder="e.g., Holiday to Budapest, Grandma's birthday">
                    <div class="helper-text">Optional: Makes the message extra magical</div>
                </div>

                <div class="form-group">
                    <label for="favoriteActivities">Favorite Activities or Hobbies</label>
                    <input type="text" id="favoriteActivities" name="favoriteActivities" placeholder="e.g., Swimming, playing football, reading">
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Create My Santa Voicemail âœ¨
                </button>
            </form>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <div class="success-icon">ðŸŽ…</div>
            <h2>Thank You!</h2>
            <p>Santa is preparing your magical voicemail right now!</p>
            <p class="success-highlight">Check your email within the next 5 minutes ðŸ“§</p>
            <p style="margin-top: 20px; font-size: 14px; color: rgba(255,255,255,0.9);">Don't forget to check your spam folder just in case!</p>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        async function validateToken() {
            if (!token) {
                showError('No access token found. Please use the link from your email.');
                return;
            }
            try {
                const response = await fetch(`https://n8n-tcjx-production.up.railway.app/webhook-test/validate-token?token=${encodeURIComponent(token)}`);
                const data = await response.json();

                if (response.ok && (data.success || data.ok === true)) {
                    document.getElementById('accessToken').value = token;
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('formSection').classList.add('show');
                } else {
                    showError(data.message || data.reason || 'Access denied. Please check your email for a valid link.');
                }
            } catch (error) {
                console.error('Validation error:', error);
                showError('Unable to validate your access. Please try again or contact support.');
            }
        }

        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorState').classList.add('show');
        }

        document.querySelectorAll('input[name="hasSiblings"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const siblingsField = document.getElementById('siblingsField');
                this.value === 'yes' ? siblingsField.classList.add('show') : siblingsField.classList.remove('show');
                if (this.value === 'no') document.getElementById('siblings').value = '';
            });
        });

        document.querySelectorAll('input[name="hasPets"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const petNamesField = document.getElementById('petNamesField');
                this.value === 'yes' ? petNamesField.classList.add('show') : petNamesField.classList.remove('show');
                if (this.value === 'no') document.getElementById('petNames').value = '';
            });
        });

        document.getElementById('santaForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Magic... âœ¨';

            const formData = {
                token: document.getElementById('accessToken').value,
                childName: document.getElementById('childName').value,
                age: document.getElementById('age').value,
                familyMembers: document.getElementById('familyMembers').value,
                hasSiblings: document.querySelector('input[name="hasSiblings"]:checked').value,
                siblings: document.getElementById('siblings').value || '',
                hasPets: document.querySelector('input[name="hasPets"]:checked').value,
                petNames: document.getElementById('petNames').value || '',
                niceThings: document.getElementById('niceThings').value,
                wishes: document.getElementById('wishes').value,
                recentTrips: document.getElementById('recentTrips').value || '',
                favoriteActivities: document.getElementById('favoriteActivities').value || ''
            };

            const webhookForm = document.createElement('form');
            webhookForm.method = 'POST';
            webhookForm.action = 'https://n8n-tcjx-production.up.railway.app/webhook/Santa-voicemail';
            webhookForm.target = 'webhookFrame';

            for (const [key, value] of Object.entries(formData)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                webhookForm.appendChild(input);
            }

            let iframe = document.getElementById('webhookFrame');
            if (!iframe) {
                iframe = document.createElement('iframe');
                iframe.name = 'webhookFrame';
                iframe.id = 'webhookFrame';
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
            }

            document.body.appendChild(webhookForm);
            webhookForm.submit();

            setTimeout(() => {
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('successMessage').classList.add('show');
                document.body.removeChild(webhookForm);
            }, 500);
        });

        validateToken();
    </script>
</body>
</html>
